(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/goodsDetail/goodsDetail"],{3934:function(t,o,e){"use strict";var s=function(){var t=this,o=t.$createElement,s=(t._self._c,e("d028")),i=e("4573"),a=e("c2d5"),n=e("6938"),r=t.__map(t.good.goodsDetailSpecList,function(o,e){var s=t.__map(o.goodsDetailSpecValueList,function(o,e){var s=t.getStatus(o.value),i=t.getStatus(o.value);return{$orig:t.__get_orig(o),m4:s,m5:i}});return{$orig:t.__get_orig(o),l0:s}});t._isMounted||(t.e0=function(o){t.isShare=!0},t.e1=function(o){t.isStandard=!0},t.e2=function(o){t.isSure=!1},t.e3=function(o){t.isSure=!1},t.e4=function(o){t.isShare=!1},t.e5=function(o){t.isStandard=!1}),t.$mp.data=Object.assign({},{$root:{m0:s,m1:i,m2:a,m3:n,l1:r}})},i=[];e.d(o,"a",function(){return s}),e.d(o,"b",function(){return i})},"8a90":function(t,o,e){},c1ee:function(t,o,e){"use strict";var s=e("8a90"),i=e.n(s);i.a},cc9d:function(t,o,e){"use strict";e.r(o);var s=e("cd2d"),i=e.n(s);for(var a in s)"default"!==a&&function(t){e.d(o,t,function(){return s[t]})}(a);o["default"]=i.a},cd2d:function(t,o,e){"use strict";(function(t,s){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=d(e("12ec")),a=d(e("5ff4")),n=e("c87f"),r=(e("7384"),d(e("e0d7"))),u=d(e("122c"));function d(t){return t&&t.__esModule?t:{default:t}}function c(t){return h(t)||g(t)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function g(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function h(t){if(Array.isArray(t)){for(var o=0,e=new Array(t.length);o<t.length;o++)e[o]=t[o];return e}}var f=function(){return Promise.all([e.e("common/vendor"),e.e("components/good/Share")]).then(e.bind(null,"4923"))},m=function(){return e.e("components/common/Player").then(e.bind(null,"e988"))},p=function(){return e.e("components/good/Standard").then(e.bind(null,"491d"))},v=function(){return e.e("components/common/SwiperDot").then(e.bind(null,"32ea"))},S={data:function(){return{imgLoading:!0,opt:!1,indicatorDots:!1,autoplay:!1,interval:5e3,duration:500,shopId:"",goodsId:"",curDisable:!1,nums:1,startNum:1,curs:[],totalPrice:0,stock:0,deep:1,list:[],isPlayer:!1,videoUrl:"",imageList:[],videoObj:{},postType:0,isStandard:!1,good:{hasColletion:!1,rules:[],goods:{},goodsSkuList:[],standardList:[]},cur:0,total:0,icon:{ColSta:i.default,ColAct:a.default},counter:0,isSure:!1,isShare:!1,nav:"",isGoodsTitle:!1,goodsTitle:""}},components:{Share:f,Standard:p,Player:m,SwiperDot:v},computed:{payPrice:function(){return u.default.formatMoney(100*this.totalPrice*this.nums/100,2)}},onLoad:function(t){this.shopId=t.shopId,this.goodsId=t.goodsId},onShow:function(){var o=this;t.getStorageSync("access_token")&&(0,n.getGoodNums)({status:""}).then(function(t){"1000"==t.code&&(o.counter=t.data.itemNum)}),(0,n.getDetail)({shopId:this.shopId,goodsId:this.goodsId}).then(function(e){if("1000"==e.code){var s=e.data.goodsDetail;s.hasColletion=e.data.hasColletion,s.standardList=[],s.goods.minPrice=u.default.formatMoney(s.goods.minPrice,2),s.goods.maxPrice=u.default.formatMoney(s.goods.maxPrice,2);var i=[];s.goodsImgVOList.forEach(function(t){2!=t.type?i.push(t):o.videoObj[t.sort]=t.imgUrl}),o.imageList=i,o.total=i.length,null==s.goods.unitName&&(s.goods.unitName=s.goodsDetailSpecList[0].name);var a,d=function(t,o){return t[o]={},t[o]},c={},l=[c];s.goodsDetailSpecList.forEach(function(t){var o=[];l.forEach(function(e){t.goodsDetailSpecValueList.forEach(function(t,s){o.push(d(e,t.value))})}),l=o});var g=1==s.goods.showStyle&&s.goodsSkuList.length>1;a=s.goodsDetailSpecList[0].valueSuffix||"";var h=JSON.parse(s.goodsSkuList[0].priceExp);2==s.goods.showStyle&&(s.goodsSkuList[0].price=h[0].price,s.goodsSkuList[0].startNum=h[0].startQuantity);var f=!0;if(s.goodsSkuList.forEach(function(t,o){var e=c,i=t.attrValueList.length;s.standardList[o]=[],t.attrValueList.forEach(function(n,r){e=e[n.value],i-1==r&&(e.disabled=!!(t.stock<t.startNum),e.price=t.price,e.stock=t.stock,e.id=t.id,e.startNum=t.startNum),g?(s.standardList[o].push("".concat(n.value).concat(s.goods.unitName,"起批")),s.standardList[o].push("".concat(n.value).concat(a))):s.standardList[o].push(n.value),f=f&&e.disabled}),s.standardList[o].push("￥".concat(t.price,"/").concat(s.goods.unitName))}),s.tree=c,s.isInvalid=f,3!=s.goods.status&&r.default.tips("商品已下架啦,看下其它的吧"),2==s.goods.showStyle){var m=s.goodsSkuList[0].attrValueList[0];s.goodsList=[],h.forEach(function(t,o){s.goodsList.push({startNum:t.startQuantity,price:t.price,unit:m.name,id:m.skuId})})}s.sufName=a,o.good=s||{},o.deep=o.good.goodsDetailSpecList.length,o.good.goodsDetailSpecList.forEach(function(t){o.curs.push({key:t.goodsDetailSpecValueList[0].value,disabled:void 0})}),o.calcPrice(),o.opt=!0,(0,n.getPostItem)({id:s.goods.postSettingId}).then(function(t){o.postType=t.data.type}),t.getStorageSync("access_token")&&o.getHasCollect(o.goodsId)}})},methods:{imgLoad:function(t){var o=this;setTimeout(function(){o.imgLoading=!1},500)},getHasCollect:function(t){var o=this,e={targetId:t};(0,n.getHasCollect)(e).then(function(t){o.good.hasColletion=t.data})},closePlayer:function(){this.isPlayer=!1,this.videoUrl=""},submitInfo:function(t){console.log(s(t.detail.formId," at pages\\order\\goodsDetail\\goodsDetail.vue:503"))},goHome:function(){t.switchTab({url:"/pages/main/main"})},doIncrease:function(){this.nums<this.stock&&++this.nums,this.calcPrice(1)},doDecrease:function(){+this.nums>this.startNum&&(--this.nums,this.curDisable||(this.nums=this.startNum)),this.calcPrice(1)},checkNum:function(t){var o=+t.target.value;o>this.stock?(r.default.tips("超出库存"+this.stock+"啦"),this.nums=this.stock):o<this.startNum&&(this.curDisable||(r.default.tips("起批量不能低于"+this.startNum),this.nums=this.startNum)),this.calcPrice(1)},getStatus:function(t){for(var o=this.good.tree,e=0;e<this.deep;e++){if(e===this.deep-1)return o=o[t],!!o&&o.disabled;o=o[this.curs[e]["key"]]}},calcPrice:function(t){var o=this,e=this.good.tree;if(2!=this.good.goods.showStyle)this.curs.forEach(function(s,i){e=e[s["key"]],i===o.curs.length-1&&(o.totalPrice=parseFloat(e.price||0),o.stock=e.stock,!t&&(o.nums=e.disabled?0:e.startNum),o.startNum=e.startNum||0,s.disabled=e.disabled,o.curDisable=e.disabled)});else{this.curs.forEach(function(s,i){e=e[s["key"]],i==o.curs.length-1&&(o.stock=e.stock,!t&&(o.nums=e.disabled?0:e.startNum),s.disabled=e.disabled)});var s=c(this.good.goodsList),i=s[0],a=s[s.length-1];s.push({startNum:Math.pow(2,25),price:a.price}),s.unshift({startNum:i.startNum,price:i.price}),this.startNum=i.startNum;for(var n=1,r=s.length-1;n<r;n++)this.nums>=s[n].startNum&&this.nums<s[n+1].startNum&&(this.totalPrice=s[n].price)}},selOption:function(t,o){this.getStatus();var e=c(this.curs);e[o]["key"]=t,this.curs=e,this.calcPrice()},navigate:function(){for(var o=this,e=!1,s=this.good.tree,i=0;i<this.deep;i++)s=s[this.curs[i]["key"]],i===this.deep-1&&(e=s.disabled);if(e)return r.default.tips("请选择所有的项");if(this.nav.match(/cart/))(0,n.addToCart)({skuId:s.id,num:this.nums}).then(function(t){o.isSure=!1,o.getUpdate()});else if(this.nav.match(/submit/i)){var a=JSON.stringify({addressId:"",goodsCount:this.nums,goodsId:this.goodsId,shopId:this.shopId,skuId:s.id});t.navigateTo({url:"/pages/order/submit/submit?submitData="+a+"&isBuyNow=1"})}else t.navigateTo({url:"/pages/order/order"})},goCart:function(){t.getStorageSync("access_token")?t.switchTab({url:"/pages/order/order"}):t.navigateTo({url:"/pages/login/login"})},goPostSetting:function(o){t.navigateTo({url:"/pages/order/prompt/prompt?id="+o})},getUpdate:function(){var o=this;t.getStorageSync("access_token")&&(0,n.getGoodNums)({status:""}).then(function(t){"1000"==t.code?(o.counter=t.data.itemNum,o.isSure=!1,r.default.tips("已成功加入进货单")):(o.goodsTitle=res.message,o.isGoodsTitle=!0,setTimeout(function(){o.isGoodsTitle=!1},1500))})},play:function(o){3==o.type&&(this.videoUrl=this.videoObj[o.sort],t.navigateTo({url:"/pages/order/goodsDetail/video/video?url="+this.videoUrl}))},triShare:function(){},changeBanner:function(t){this.cur=t.detail.current},showConfirm:function(o){t.getStorageSync("access_token")?(this.nav=o,this.isSure=!0):t.navigateTo({url:"/pages/login/login"})},changeCollect:function(){t.getStorageSync("access_token")?(this.good.hasColletion=!this.good.hasColletion,this.good.hasColletion?r.default.tips("已收藏"):r.default.tips("取消收藏"),this.good.hasColletion?(0,n.setCollect)({goodsId:this.good.goods.id,isLoading:1}):(0,n.removeCollect)({goodsId:this.good.goods.id,isLoading:1})):t.navigateTo({url:"/pages/login/login"})}}};o.default=S}).call(this,e("6e42")["default"],e("0de9")["default"])},e908:function(t,o,e){"use strict";e.r(o);var s=e("3934"),i=e("cc9d");for(var a in i)"default"!==a&&function(t){e.d(o,t,function(){return i[t]})}(a);e("c1ee");var n=e("2877"),r=Object(n["a"])(i["default"],s["a"],s["b"],!1,null,"612cfc3a",null);o["default"]=r.exports},f299:function(t,o,e){"use strict";(function(t){e("b440"),e("921b");s(e("66fd"));var o=s(e("e908"));function s(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("6e42")["createPage"])}},[["f299","common/runtime","common/vendor"]]]);