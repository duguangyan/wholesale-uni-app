(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"1f60":function(e,n,o){"use strict";var t=o("cc4e"),i=o.n(t);i.a},"303f":function(e,n,o){"use strict";var t=function(){var e=this,n=e.$createElement;e._self._c},i=[];o.d(n,"a",function(){return t}),o.d(n,"b",function(){return i})},"3cf9":function(e,n,o){"use strict";o.r(n);var t=o("c548"),i=o.n(t);for(var s in t)"default"!==s&&function(e){o.d(n,e,function(){return t[e]})}(s);n["default"]=i.a},"8cbe":function(e,n,o){"use strict";o.r(n);var t=o("303f"),i=o("3cf9");for(var s in i)"default"!==s&&function(e){o.d(n,e,function(){return i[e]})}(s);o("1f60");var a=o("2877"),c=Object(a["a"])(i["default"],t["a"],t["b"],!1,null,"0d44eb0e",null);n["default"]=c.exports},b63d:function(e,n,o){"use strict";(function(e){o("b440"),o("921b");t(o("66fd"));var n=t(o("8cbe"));function t(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,o("6e42")["createPage"])},c548:function(e,n,o){"use strict";(function(e,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=c(o("f585")),s=c(o("e0d7")),a=o("7384");function c(e){return e&&e.__esModule?e:{default:e}}var r={data:function(){return{phone:"",code:"",codeText:"获取验证码",codeNum:"",isRight:!1,setCodeInterval:"",deviceId:"",appID:"wxb8afa388fa540c2a",weixinCode:"",delta:1,from:""}},components:{},onBackPress:function(){e.getStorageSync("access_token")||("main"==e.getStorageSync("pagePath")?e.switchTab({url:"/pages/main/main"}):e.switchTab({url:"/pages/user/user"})),console.log(t("onBackPress"," at pages\\login\\login.vue:87"))},onHide:function(){console.log(t("onHide"," at pages\\login\\login.vue:90")),""!=this.setCodeInterval&&clearInterval(this.setCodeInterval)},onLoad:function(e){e.delta&&(this.delta=e.delta),e.from&&(this.from=e.from)},onShow:function(){e.setStorageSync("isLogin",0)},methods:{goProtocal:function(){e.navigateTo({url:"/pages/user/protocal/protocal"})},getOpenIdByCode:function(){e.login({provider:"weixin",success:function(n){console.log(t("code",JSON.stringify(n.code)," at pages\\login\\login.vue:114"));var o={code:n.code,providerId:"miniProgram"};console.log(t(o," at pages\\login\\login.vue:119")),(0,a.openIdByCode)(o).then(function(n){console.log(t(n," at pages\\login\\login.vue:121")),"1000"==n.code&&e.setStorageSync("openid",n.data)})}})},wxLogin:function(){var n=this;e.getProvider({service:"oauth",success:function(o){console.log(t(o.provider," at pages\\login\\login.vue:136")),~o.provider.indexOf("weixin")&&e.login({provider:"weixin",success:function(o){console.log(t("-------获取openid(unionid)-----"," at pages\\login\\login.vue:142")),console.log(t(JSON.stringify(o)," at pages\\login\\login.vue:143"));var i=o.authResult.access_token,s=o.authResult.openid,c={grant_type:"wx_app",scope:2,client_id:"cwap",client_secret:"xx",systemId:2,deviceId:n.getUUID(),accessToken:i,openId:s};console.log(t("data->>",c," at pages\\login\\login.vue:156")),(0,a.postUserLogin)(c).then(function(o){console.log(t(JSON.stringify(o)," at pages\\login\\login.vue:158")),"9999"==o.code?e.getUserInfo({provider:"weixin",success:function(n){console.log(t("-------获取微信用户所有-----"," at pages\\login\\login.vue:163")),console.log(t(JSON.stringify(n.userInfo)," at pages\\login\\login.vue:164")),c.userInfo=n.userInfo,e.navigateTo({url:"/pages/login/binding/binding?data="+JSON.stringify(c)})}}):(e.setStorageSync("access_token",o.access_token),e.setStorageSync("refresh_token",o.refresh_token),e.setStorageSync("uid",o.id),n.getUserInfoDates())})}})}})},getuserinfox:function(n){var o=this;console.log(t(n," at pages\\login\\login.vue:189")),e.login({provider:"weixin",success:function(n){console.log(t(n," at pages\\login\\login.vue:193"));var i={grant_type:"mini_program",scope:2,client_id:"cwap",client_secret:"xx",systemId:2,deviceId:o.getUUID(),miniCode:n.code};console.log(t("data->",i," at pages\\login\\login.vue:203")),(0,a.postUserLogin)(i).then(function(n){"9999"==n.code?e.getUserInfo({provider:"weixin",success:function(n){console.log(t("-------获取微信用户所有-----"," at pages\\login\\login.vue:209")),console.log(t(JSON.stringify(n.userInfo)," at pages\\login\\login.vue:210")),i.userInfo=n.userInfo,e.navigateTo({url:"/pages/login/binding/binding?data="+JSON.stringify(i)})}}):(e.setStorageSync("access_token",n.access_token),e.setStorageSync("access_token",n.refresh_token),e.setStorageSync("uid",n.id),o.getUserInfoDates())})}})},doIsLogin:function(){this.isRight=!i.default.isPhone(this.phone)&&""!==this.code},getCode:function(){var e=this;if(console.log(t(i.default.isPhone(this.phone)," at pages\\login\\login.vue:235")),""!==this.codeNum)return!1;if(i.default.isPhone(this.phone))return""===this.phone?(s.default.tips("手机号不能为空"),!1):(s.default.tips("手机号码不正确"),!1);this.deviceId=this.getUUID();var n={mobile:this.phone,deviceId:this.deviceId};(0,a.postUserSms)(n).then(function(n){s.default.tips(n.message),"1000"===n.code&&(e.codeText="重新发送",e.codeNum=59,e.setCodeInterval=setInterval(function(){0===e.codeNum?(e.codeNum="",clearInterval(e.setCodeInterval)):e.codeNum--},1e3))}).catch(function(e){s.default.tips(e.message||"错误")})},dologin:function(){var n=this;if(this.isRight){plus.device.uuid;var o={grant_type:"sms_code",scope:"2",client_id:"cwap",client_secret:"xx",systemId:"2",deviceId:this.deviceId,mobile:this.phone,smsCode:this.code};(0,a.postUserLogin)(o).then(function(o){e.setStorageSync("access_token",o.access_token),e.setStorageSync("refresh_token",o.refresh_token),e.setStorageSync("uid",o.id),e.setStorageSync("phone",n.phone),""!=n.setCodeInterval&&clearInterval(n.setCodeInterval),n.getUserInfoDates()}).catch(function(e){s.default.tips(e.message||"登录错误")})}},getUserInfoDates:function(){var n=this;(0,a.getUserInfoData)().then(function(o){"1000"===o.code&&(o.data.phone&&e.setStorageSync("phone",o.data.phone),e.setStorageSync("nickName",o.data.nickName),e.setStorageSync("headImgUrl",o.data.headImgUrl),"order"==n.from?"main"==e.getStorageSync("pagePath")?e.switchTab({url:"/pages/main/main"}):e.switchTab({url:"/pages/user/user"}):e.navigateBack({delta:parseInt(n.delta)}))}).catch(function(e){s.default.tips(e.message||"获取用户信息错误")})},getUUID:function(){for(var e=[],n="0123456789abcdef",o=0;o<36;o++)e[o]=n.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=n.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var t=e.join("");return t}}};n.default=r}).call(this,o("6e42")["default"],o("0de9")["default"])},cc4e:function(e,n,o){}},[["b63d","common/runtime","common/vendor"]]]);